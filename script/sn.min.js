!function(){$(function(){var a;return null==window.console&&(window.console={info:function(){},log:function(){},error:function(){},warn:function(){}}),moment.lang("ru"),a={init:function(a){return null==a&&(a={}),$(this).sn("setup",a),$(this).sn("cookies"),$(this).sn("start")},setup:function(a){var b;return null==a&&(a={}),window.sn={},b={levels:{},users:{},content:{},conf:{},result:{},theme:{},settings:{}},$.extend(!0,b,a),$(this).data("sn",b),b},cookies:function(){return null==window.user&&(window.user={}),$.cookie("user_id")&&(window.user.id=$.cookie("user_id")),$.cookie("user_login")&&(window.user.login=$.cookie("user_login")),$.cookie("user_hash")?window.user.hash=$.cookie("user_hash"):void 0},start:function(a){return null==a&&(a={}),"undefined"!=typeof console&&null!==console&&console.log("configuration..."),$(this).snConf(),"undefined"!=typeof console&&null!==console&&console.log("autoload..."),$(this).snEvents("#autoload/two/three:anchor")}},$.fn.sn=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}})}.call(this),function(){$(function(){var a;return a={init:function(a){null==a&&(a={})},settings:function(){var a;return a=$(this).data("sn"),"undefined"!=typeof console&&null!==console&&console.log("conf: settings.json"),$.ajax({url:"conf/settings.json",async:!1,dataType:"json",success:function(b){return null!=b&&($.extend(a.settings,b),a.settings.enable=!0,a.conf.settings=!0),$(this).data("sn",a)}})}},$.fn.snConf=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}})}.call(this),function(){$(function(){var a;return a={init:function(a){var b,c,d;if(null==a&&(a={}),b={href:"#autoload"},"object"!=typeof a?c=a:($.extend(!0,b,a),c=b.href),"#"!==c&&c.match(/#[a-zA-Z0-9\_\-]+/)&&(d=c.match(/[a-zA-Z0-9\_\-]+/g),"undefined"!=typeof console&&null!==console&&console.info("url: "+c),"undefined"!=typeof console&&null!==console&&console.info("levels: ",d),null!=d[0]&&"spoiler"!==d[0])){switch(d[0]){case"autoload":$(this).snUsers(),$(this).snMaps();break;default:null!=d[1]&&null!=d[2]&&(window.sn.part=d[0])}return $(this).click(d)}}},$.fn.snEvents=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}})}.call(this),function(){$(function(){var a;return a={init:function(a){null==a&&(a={})}},$.fn.snTriggers=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}})}.call(this),function(){$(function(){var a;return a={init:function(a){return null==a&&(a={}),$(this).snUsersTriggers("signinFormSubmit")},afterSignin:function(a){return null==a&&(a={}),a.signin&&null!=a.signin.id&&null!=a.signin.login&&null!=a.signin.hash?(window.user={id:a.signin.id,login:a.signin.login,hash:a.signin.hash},$.cookie("user_id",a.signin.id,{expires:365}),$.cookie("user_login",a.signin.login,{expires:365}),$.cookie("user_hash",a.signin.hash,{expires:365})):void 0},exit:function(){return null!=window.user&&(window.user={}),$.removeCookie("user_id"),$.removeCookie("user_login"),$.removeCookie("user_hash")}},$.fn.snUsers=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}})}.call(this),function(){$(function(){var a;return a={signin:function(a,b){return $.ajax({url:"index.php",type:"GET",data:{action:"signin",login:null!=a.login?a.login:"",password:null!=a.password?a.password:"",hash:null!=a.hash?a.hash:""},dataType:"json",success:function(a){return null!=a&&null!=b?b(a):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}})}},$.fn.snUsersAjax=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):void 0}})}.call(this),function(){$(function(){var a,b;return b=this,$.cookie("user_login")&&$.cookie("user_hash")&&$(b).snUsersAjax("signin",{login:$.cookie("user_login"),hash:$.cookie("user_hash")},function(a){return null!=a.signin&&($(b).snUsers("afterSignin",a),a.signin)?($(".signin-exit-link").parent("li").show(),$(".signin-enter-link").parent("li").hide()):void 0}),a={signinFormSubmit:function(a){return null==a&&(a={}),b=this,$("#signin-form").on("submit",function(a){return a.preventDefault(),$(".signin-alert").hide(),$(b).snUsersAjax("signin",{login:$("#signin-login").val(),password:$("#signin-password").val()},function(a){return null!=a.signin?($(b).snUsers("afterSignin",a),a.signin?($("#signin-form").hide(),$(".signin-exit-link").parent("li").show(),$(".signin-enter-link").parent("li").hide(),$(".signin-alert-success").show(),setTimeout(function(){return $("#modal-signin").modal("hide")},500)):($(".signin-alert-error").show(),$("#signin-password").val(""))):void 0})}),$(".signin-enter-link").on("click",function(a){return a.preventDefault(),$("#signin-login").val(""),$("#signin-password").val(""),$(".signin-alert").hide()}),$(".signin-exit-link").on("click",function(a){return a.preventDefault(),$(".signin-exit-link").parent("li").hide(),$(".signin-enter-link").parent("li").show(),$("#signin-form").show(),$(".signin-alert").hide(),$("#signin-password").val(""),$(b).snUsers("exit")})}},$.fn.snUsersTriggers=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):void 0}})}.call(this),function(){$(function(){var a;return a={init:function(a){var b;return null==a&&(a={}),b=this,ymaps.ready(function(){var a,c,d;return a=new ymaps.Map("map",{center:[56.840001,53.239778],zoom:12,behaviors:["default","scrollZoom"]}),a.options.set("scrollZoomSpeed",4),a.controls.add("zoomControl"),a.controls.add("typeSelector"),a.controls.add("mapTools"),c=[],a.events.add("click",function(c){var d,e,f;return null!=(null!=(d=window.user)?d.id:void 0)&&null!=(null!=(e=window.user)?e.login:void 0)&&null!=(null!=(f=window.user)?f.hash:void 0)?a.balloon.isOpen()?a.balloon.close():$(b).snMapsAjax("getAgents",function(d){return d.date=$(b).snMapsFn("date"),d.coordinates=c.get("coordPosition"),a.balloon.open(d.coordinates,{contentHeader:$(b).snMapsFn("header",d,"create"),contentBody:$(b).snMapsFn("body",d,"create")}),$(b).snMapsFn("datepicker"),$(b).snMapsFn("typeahead",d),$(b).snMapsTriggers("create",c),$(b).snMapsTriggers("close",a.balloon)}):void 0}),d=location.href.match(/[a-z0-9]{8}\-[a-z0-9]{4}\-[a-z0-9]{4}\-[a-z0-9]{4}\-[a-z0-9]{12}/i)||[],$(b).snMapsAjax("getPoints",function(e){var f,g,h;h=[];for(f in e)g=e[f],null!=g.POINT?(null!=g.STREET&&g.STREET||$(b).snMapsFn("street",$(b).snMapsPlacemark("coordinates",g)),c[f]=$(b).snMapsPlacemark(ymaps,g),a.geoObjects.add(c[f]),null!=d[0]?g.D$UUID===d[0]?h.push(a.geoObjects.each(function(b){return b.properties.get("uuid")===d[0]?b.balloon.open(a.getCenter()):void 0})):h.push(void 0):h.push(void 0)):h.push(void 0);return h})})}},$.fn.snMaps=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}})}.call(this),function(){$(function(){var a;return a={getPoints:function(a){return $.ajax({url:"index.php",type:"GET",data:{action:"getPoints"},dataType:"json",success:function(b){return null!=b.points&&null!=a?a(b.points):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}})},getBalloonContent:function(a,b){var c,d,e;return null!=a?$.ajax({url:"index.php",type:"GET",data:{action:"getBalloonContent",uuid:a,userid:null!=(null!=(c=window.user)?c.id:void 0)?window.user.id:"",login:null!=(null!=(d=window.user)?d.login:void 0)?window.user.login:"",hash:null!=(null!=(e=window.user)?e.hash:void 0)?window.user.hash:""},dataType:"json",success:function(a){return null!=a.content&&null!=a.signin&&null!=b?b(a):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}}):void 0},addNewMark:function(a,b,c){var d,e,f;return null!=a&&null!=b?$.ajax({url:"index.php",type:"GET",data:{action:"addNewMark",lat:a[0],lon:a[1],vid:b,userid:null!=(null!=(d=window.user)?d.id:void 0)?window.user.id:"",login:null!=(null!=(e=window.user)?e.login:void 0)?window.user.login:"",hash:null!=(null!=(f=window.user)?f.hash:void 0)?window.user.hash:""},dataType:"json",success:function(a){return null!=a.res&&null!=c?c(a.res):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}}):void 0},removeMark:function(a,b){var c,d,e;return null!=a?$.ajax({url:"index.php",type:"GET",data:{action:"removeMark",uuid:a,userid:null!=(null!=(c=window.user)?c.id:void 0)?window.user.id:"",login:null!=(null!=(d=window.user)?d.login:void 0)?window.user.login:"",hash:null!=(null!=(e=window.user)?e.hash:void 0)?window.user.hash:""},dataType:"json",success:function(a){return null!=a.res&&null!=b?b(a.res):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}}):void 0},saveMark:function(a,b,c){var d,e,f;return null!=a&&null!=b?$.ajax({url:"index.php",type:"GET",data:{action:"saveMark",uuid:a,agent:b.agent,info:b.info,date1:b.date1,date2:b.date2,date3:b.date3,lat:b.lat,lon:b.lon,vid:b.vid,userid:null!=(null!=(d=window.user)?d.id:void 0)?window.user.id:"",login:null!=(null!=(e=window.user)?e.login:void 0)?window.user.login:"",hash:null!=(null!=(f=window.user)?f.hash:void 0)?window.user.hash:""},dataType:"json",success:function(a){return null!=a.res&&null!=c?c(a.res):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}}):void 0},dragMark:function(a,b,c){var d,e,f;return null!=a&&null!=b?$.ajax({url:"index.php",type:"GET",data:{action:"dragMark",uuid:a,lat:b[0],lon:b[1],userid:null!=(null!=(d=window.user)?d.id:void 0)?window.user.id:"",login:null!=(null!=(e=window.user)?e.login:void 0)?window.user.login:"",hash:null!=(null!=(f=window.user)?f.hash:void 0)?window.user.hash:""},dataType:"json",success:function(a){return null!=a.res&&null!=c?c(a.res):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}}):void 0},createMark:function(a,b){var c,d,e;return null!=a?$.ajax({url:"index.php",type:"GET",data:{action:"createMark",agent:a.agent,info:a.info,date1:a.date1,date2:a.date2,date3:a.date3,lat:a.lat,lon:a.lon,vid:a.vid,userid:null!=(null!=(c=window.user)?c.id:void 0)?window.user.id:"",login:null!=(null!=(d=window.user)?d.login:void 0)?window.user.login:"",hash:null!=(null!=(e=window.user)?e.hash:void 0)?window.user.hash:""},dataType:"json",success:function(a){return null!=a.res&&null!=b?b(a.res):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}}):void 0},getAgents:function(a){var b,c,d;return $.ajax({url:"index.php",type:"GET",data:{action:"getAgents",userid:null!=(null!=(b=window.user)?b.id:void 0)?window.user.id:"",login:null!=(null!=(c=window.user)?c.login:void 0)?window.user.login:"",hash:null!=(null!=(d=window.user)?d.hash:void 0)?window.user.hash:""},dataType:"json",success:function(b){return null!=b.agents&&null!=a?a(b):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}})},editStreet:function(a,b,c){return null!=a&&null!=b?$.ajax({url:"index.php",type:"GET",data:{action:"editStreet",street:a,lat:b[0],lon:b[1]},dataType:"json",success:function(a){return"undefined"!=typeof console&&null!==console&&console.info(a),null!=a.res&&null!=c?c(a.res):void 0},error:function(a,b,c){return"undefined"!=typeof console&&null!==console?console.log(a,b,c):void 0}}):void 0}},$.fn.snMapsAjax=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):void 0}})}.call(this),function(){$(function(){var a;return a={datepicker:function(){return $("#dp1").datepicker(),$("#dp2").datepicker(),$("#dp3").datepicker()},date:function(){return moment().format("DD.MM.YYYY")},data:function(){return{agent:$("#agent").val(),info:$("#info").val(),date1:$("#date1").val(),date2:$("#date2").val(),date3:$("#date3").val(),lat:a.lat(),lon:a.lon(),vid:$(".vid_0").hasClass("active")?0:1}},coordinates:function(){return[a.lat(),a.lon()]},lat:function(){return parseFloat($("#lat").val().toString().replace(",","."))},lon:function(){return parseFloat($("#lon").val().toString().replace(",","."))},checkPlanPeriod:function(a){var b,c,d;return null==a&&(a={}),null==a.PLAN_PERIOD_END&&(a.PLAN_PERIOD_END=$("#date2").val()),null!=a.PLAN_PERIOD_END&&a.PLAN_PERIOD_END.match("[0-9]{2}.[0-9]{2}.[0-9]{4}")?(b=86400,d=moment(a.PLAN_PERIOD_END.toString(),"DD.MM.YYYY").unix(),c=moment().unix(),console.log(c,d,b,c-d),b>c-d?!0:!1):!1},preset:function(b){var c;return null==b&&(b={}),c=0,c=null!=b.VID_ID?"0"===b.VID_ID?0:1:$(".vid_0").hasClass("active")?0:1,0===c?a.checkPlanPeriod(b)?"twirl#workshopIcon":"twirl#redDotIcon":a.checkPlanPeriod(b)?"twirl#turnRightIcon":"twirl#redDotIcon"},draggable:function(a){var b,c,d;return null!=a?(null!=(b=a.USER_ID)?b.toString():void 0)===(null!=(c=window.user)?null!=(d=c.id)?d.toString():void 0:void 0)?!0:!1:void 0},street:function(a){var b;return"undefined"!=typeof ymaps&&null!==ymaps&&null!=a?(b=ymaps.geocode(a,{json:!0,kind:"house",results:1}),b.then(function(a){var b,c,d,e,f,g,h,i;return null!=(null!=a?null!=(e=a.GeoObjectCollection)?e.featureMember[0]:void 0:void 0)&&(b=a.GeoObjectCollection.featureMember[0],null!=(null!=b?null!=(f=b.GeoObject)?f.name:void 0:void 0)&&(d=b.GeoObject.name)),null!=(null!=a?null!=(g=a.GeoObjectCollection)?null!=(h=g.metaDataProperty)?null!=(i=h.GeocoderResponseMetaData)?i.request:void 0:void 0:void 0:void 0)&&(c=a.GeoObjectCollection.metaDataProperty.GeocoderResponseMetaData.request.toString().split(",")),null!=c&&null!=d?$(this).snMapsAjax("editStreet",d,c):void 0})):void 0},size:function(a,b){var c;return null!=a&&null!=b&&(c=b.toString().split("x"),null!=c[0]&&null!=c[1])?(a.options.set("balloonMinWidth",parseInt(c[0])),a.options.set("balloonMinHeight",parseInt(c[1]))):void 0},header:function(a,b){if(null==a&&(a={}),null==b)return new EJS({url:"view/balloonHeader.html",ext:".html",type:"[",cache:!1}).render(a);switch(b){case"create":return new EJS({url:"view/balloonHeaderCreate.html",ext:".html",type:"[",cache:!1}).render(a);case"editor":return new EJS({url:"view/balloonHeaderEditor.html",ext:".html",type:"[",cache:!1}).render(a)}},body:function(a,b){if(null==a&&(a={}),null==b)return new EJS({url:"view/balloonContent.html",ext:".html",type:"[",cache:!1}).render(a);switch(b){case"create":return new EJS({url:"view/balloonContentCreate.html",ext:".html",type:"[",cache:!1}).render(a);case"editor":return new EJS({url:"view/balloonContentEditor.html",ext:".html",type:"[",cache:!1}).render(a)}},typeahead:function(a){return null!=a.agents?$("#agent").typeahead({source:a.agents}):void 0}},$.fn.snMapsFn=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):void 0}})}.call(this),function(){$(function(){var a;return a={init:function(b,c){var d,e;return e=this,d=new b.Placemark(a.coordinates(c),a.properties(c),a.options(c)),d=a.onBalloonOpen(d),d=a.onDragStart(d),d=a.onDragEnd(d)},coordinates:function(a){return null!=(null!=a?a.POINT:void 0)?a.POINT.toString().replace(/[\s\[\]]/g,"").split(","):void 0},properties:function(a){return{hintContent:null!=a.STREET&&a.STREET?""+a.STREET:null,balloonContentHeader:"<div></div>",balloonContentBody:"<div></div>",uuid:a.D$UUID.toString()}},options:function(a){return{preset:$(this).snMapsFn("preset",a),draggable:$(this).snMapsFn("draggable",a)}},onBalloonOpen:function(b){var c;return c=this,b.events.add("balloonopen",function(d){var e,f,g;return b=d.get("target"),e=d.get("balloon"),f=b.getMap(),g=b.properties.get("uuid").toString(),$(c).snMapsAjax("getBalloonContent",g,function(f){var g,h,i,j;return f.signin&&(null!=(g=window.user)?null!=(h=g.id)?h.toString():void 0:void 0)===(null!=(i=f.content)?null!=(j=i.USER_ID)?j.toString():void 0:void 0)?(f.coordinates=a.coordinates(f.content),$(c).snMapsFn("size",b,"500x400"),f.date=$(c).snMapsFn("date"),b.properties.set("balloonContentHeader",$(c).snMapsFn("header",f,"editor")),b.properties.set("balloonContentBody",$(c).snMapsFn("body",f,"editor")),$(c).snMapsFn("datepicker"),$(c).snMapsFn("typeahead",f),$(c).snMapsTriggers("delete",d),$(c).snMapsTriggers("save",d),$(c).snMapsTriggers("close",e)):($(c).snMapsFn("size",b,"350x200"),b.properties.set("balloonContentHeader",$(c).snMapsFn("header",f)),b.properties.set("balloonContentBody",$(c).snMapsFn("body",f)))})}),b},onDragStart:function(a){var b;return b=this,a.events.add("dragstart",function(b){var c;return a=b.get("target"),c=a.geometry.getCoordinates(),a.properties.set("lastCoordinates",c)}),a},onDragEnd:function(a){var b;return b=this,a.events.add("dragend",function(c){return a=c.get("target"),$("#modal-dragmark").modal(),$(".dragmark-drag-link").off("click"),$(".dragmark-drag-link").on("click",function(c){var d,e,f;return c.preventDefault(),"yes"===$(this).data("answer")?(f=a.properties.get("uuid").toString(),d=a.geometry.getCoordinates(),$(b).snMapsAjax("dragMark",f,d),$(b).snMapsFn("street",d)):(e=a.properties.get("lastCoordinates"),a.geometry.setCoordinates(e))})}),a}},$.fn.snMapsPlacemark=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}})}.call(this),function(){$(function(){var a;return a={save:function(a){var b,c,d,e;return e=this,c=a.get("target"),b=c.getMap(),d=c.properties.get("uuid").toString(),null!=c&&null!=d?$(".mark-save-link").on("click",function(a){return a.preventDefault(),c.geometry.setCoordinates($(e).snMapsFn("coordinates")),$(e).snMapsFn("street",$(this).snMapsFn("coordinates")),c.options.set("preset",$(e).snMapsFn("preset")),$(e).snMapsAjax("saveMark",d,$(e).snMapsFn("data"),function(a){return a?void 0:alert("К сожалению, не удалось сохранить метку")})}):void 0},"delete":function(a){var b,c,d,e;return e=this,c=a.get("target"),b=c.getMap(),d=c.properties.get("uuid").toString(),null!=b&&null!=c&&null!=d?$(".mark-delete-link").on("click",function(a){return a.preventDefault(),$("#modal-deletemark").modal(),$(".deletemark-delete-link").off("click"),$(".deletemark-delete-link").on("click",function(a){return a.preventDefault(),"yes"===$(this).data("answer")?$(e).snMapsAjax("removeMark",d,function(a){return a?b.geoObjects.remove(c):alert("К сожалению, не удалось удалить метку")}):void 0})}):void 0},create:function(a){var b,c;return c=this,b=a.get("target"),"undefined"!=typeof ymaps&&null!==ymaps&&null!=b?$(".mark-create-link").on("click",function(a){return a.preventDefault(),$(c).snMapsAjax("createMark",$(c).snMapsFn("data"),function(a){var d;return a?(d=$(c).snMapsPlacemark(ymaps,a),b.geoObjects.add(d)):alert("К сожалению, не удалось создать метку")})}):void 0},close:function(a){return null!=a?$(".balloon-close").on("click",function(b){return b.preventDefault(),a.close()}):void 0}},$.fn.snMapsTriggers=function(b){return null==b&&(b={}),a[b]?a[b].apply(this,Array.prototype.slice.call(arguments,1)):void 0}})}.call(this);