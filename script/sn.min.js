$(function(){var $this;return $this={init:function(options){return null==options&&(options={}),$(this).sn("setup",options),$(this).sn("start")},setup:function(options){var sn;return null==options&&(options={}),window.sn={},sn={levels:{},users:{},content:{},conf:{},result:{},theme:{},settings:{}},$.extend(!0,sn,options),$(this).data("sn",sn),sn},start:function(options){return null==options&&(options={}),"undefined"!=typeof console&&null!==console&&console.log("configuration..."),$(this).snConf(),"undefined"!=typeof console&&null!==console&&console.log("autoload..."),$(this).snEvents("#autoload")}},$.fn.sn=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):$this.init.apply(this,arguments)}}),$(function(){var $this;return $this={init:function(options){null==options&&(options={})},settings:function(){var sn;return sn=$(this).data("sn"),"undefined"!=typeof console&&null!==console&&console.log("conf: settings.json"),$.ajax({url:"conf/settings.json",async:!1,dataType:"json",success:function(s){return null!=s&&($.extend(sn.settings,s),sn.settings.enable=!0,sn.conf.settings=!0),$(this).data("sn",sn)}})}},$.fn.snConf=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):$this.init.apply(this,arguments)}}),$(function(){var $this;return $this={init:function(options){var def,href,levels;if(null==options&&(options={}),def={href:"#autoload"},"object"!=typeof options?href=options:($.extend(!0,def,options),href=def.href),"#"!==href&&href.match(/#([a-zA-Z0-9\_\-]+)/)&&(levels={one:href.match(/#([a-zA-Z0-9\_\-]+)/,"$2"),two:href.match(/#[a-zA-Z0-9\_\-]+\/([a-zA-Z0-9\_\-]+)/,"$3"),three:href.match(/#[a-zA-Z0-9\_\-]+\/[a-zA-Z0-9\_\-]+\/([a-zA-Z0-9\_\-]+)/,"$4"),anchor:href.match(/\:([a-zA-Z0-9\_\-]+)/)},"undefined"!=typeof console&&null!==console&&console.info("url: "+href),"undefined"!=typeof console&&null!==console&&console.info("levels: ",levels),null!=levels.one&&"spoiler"!==levels.one[1])){switch(levels.one[1]){case"autoload":$(this).snMaps(),$(this).snUsers();break;default:null!=levels.two&&null!=levels.three&&(window.sn.part=levels.one[1])}return $(this).click(levels)}}},$.fn.snEvents=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):$this.init.apply(this,arguments)}}),$(function(){var $this;return $this={init:function(options){null==options&&(options={})},spoiler:function(){return"undefined"!=typeof console&&null!==console&&console.log("trigger: spoiler"),$(this).find(".spoiler-caption").on("click",function(e){return e.preventDefault(),$(this).hasClass("spoiler-open")?$(this).removeClass("spoiler-open").addClass("spoiler-close"):$(this).removeClass("spoiler-close").addClass("spoiler-open"),$(this).parent(".spoiler").children(".spoiler-body").each(function(){return $(this).hasClass("spoiler-open")?$(this).removeClass("spoiler-open").addClass("spoiler-close").hide():$(this).removeClass("spoiler-close").addClass("spoiler-open").show()})})}},$.fn.snTriggers=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):$this.init.apply(this,arguments)}}),$(function(){var $this;return $this={init:function(options){var _this;return null==options&&(options={}),_this=$(this),ymaps.ready(function(){var map;return map=new ymaps.Map("map",{center:[56.840001,53.239778],zoom:12,behaviors:["default","scrollZoom"]}),map.options.set("scrollZoomSpeed",4),map.controls.add("zoomControl"),map.controls.add("typeSelector"),map.controls.add("mapTools"),$(_this).snMapsAjax("getPoints",function(points){var clusterer,coordinates,coords,i,placemarks,point;clusterer=new ymaps.Clusterer,placemarks=[];for(i in points)point=points[i],null!=point.POINT&&(coords=(""+point.POINT).replace(/[\s\[\]]/g,""),coordinates=[coords.replace(/^(.*)\,(.*)$/,"$1"),coords.replace(/^(.*)\,(.*)$/,"$2")],placemarks[i]=new ymaps.Placemark(coordinates,{hintContent:null!=point.PLAN_PERIOD_END?"до <b>"+(""+point.PLAN_PERIOD_END)+"</b>":void 0,balloonContentHeader:'<div class="balloonContentHeader" data-id="'+point.D$UUID+'">'+point.SVID+"</div>",balloonContentBody:'<div class="balloonContentBody" data-id="'+point.D$UUID+'"></div>',uuid:""+point.D$UUID},{balloonMinWidth:350,balloonMinHeight:200,preset:"0"===point.VID_ID?"twirl#workshopIcon":"twirl#turnRightIcon"}),placemarks[i].events.add("balloonopen",function(e){var placemark,uuid;return placemark=e.get("target"),uuid=""+placemark.properties.get("uuid"),$(_this).snMapsAjax("getBalloonContent",uuid,function(balloon,signin){return signin?(placemark.options.set("balloonMinWidth",500),placemark.properties.set("balloonContentBody",$(_this).snMapsBalloon("getBalloonContentEditor",balloon))):placemark.properties.set("balloonContentBody",$(_this).snMapsBalloon("getBalloonContent",balloon))})}));return clusterer.add(placemarks),clusterer.options.set({gridSize:100,maxZoom:16,minClusterSize:2}),map.geoObjects.add(clusterer)})})}},$.fn.snMaps=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):$this.init.apply(this,arguments)}}),$(function(){var $this;return $this={getPoints:function(callback){return $.ajax({url:"index.php",type:"GET",data:{action:"getPoints"},dataType:"json",success:function(s){return null!=s.points&&null!=callback?callback(s.points):void 0},error:function(XMLHttpRequest,textStatus,error){return"undefined"!=typeof console&&null!==console?console.log(XMLHttpRequest,textStatus,error):void 0}})},getBalloonContent:function(uuid,callback){var _ref,_ref1;return null!=uuid?$.ajax({url:"index.php",type:"GET",data:{action:"getBalloonContent",uuid:uuid,login:null!=(null!=(_ref=window.user)?_ref.login:void 0)?window.user.login:"",hash:null!=(null!=(_ref1=window.user)?_ref1.hash:void 0)?window.user.hash:""},dataType:"json",success:function(s){return null!=s.content&&null!=s.signin&&null!=callback?callback(s.content,s.signin):void 0},error:function(XMLHttpRequest,textStatus,error){return"undefined"!=typeof console&&null!==console?console.log(XMLHttpRequest,textStatus,error):void 0}}):void 0}},$.fn.snMapsAjax=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):void 0}}),$(function(){var $this;return $this={getBalloonContent:function(point){return'<p>\n	<table class="table">\n		<tr>\n			<td>Исполнитель:</td>\n			<td class="text-error">'+point.SAGENT+'</td>\n		</tr>\n		<tr>\n			<td>Дата начала:</td>\n			<td class="text-error">'+point.PERIOD_BEG+'</td>\n		</tr>\n		<tr>\n			<td>План. дата закр.:</td>\n			<td class="text-error">'+point.PLAN_PERIOD_END+"</td>\n		</tr>\n	</table>\n</p>"},getBalloonContentEditor:function(point){return'<form class="form-horizontal">\n	<div class="control-group">\n		<label class="control-label">Исполнитель:</label>\n		<label class="controls">\n			<select>\n				<option>1</option>\n				<option>2</option>\n				<option>3</option>\n				<option>4</option>\n				<option>5</option>\n			</select>\n		</label>\n	</div>\n	<div class="control-group">\n		<label class="control-label">Дата начала:</label>\n		<label class="controls">\n			<input type="text" placeholder="Введите текст" value="'+point.PERIOD_BEG+'">\n		</label>\n	</div>\n	<div class="control-group">\n		<label class="control-label">План дата закр.:</label>\n		<label class="controls">\n			<input type="text" placeholder="Введите текст" value="'+point.PLAN_PERIOD_END+'">\n		</label>\n	</div>\n	<div class="control-group">\n		<label class="control-label">Комментарий:</label>\n		<label class="controls">\n			<textarea rows="3"></textarea>\n		</label>\n	</div>\n</form>\n<div class="pull-left">\n	<a class="btn btn-danger" href="#">Удалить</a>\n</div>\n<div class="pull-right">\n	<a class="btn btn-primary" href="#">Сохранить</a>\n	<a class="btn" href="#">Отмена</a>\n</div>'}},$.fn.snMapsBalloon=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):void 0}}),$(function(){var $this;return $this={init:function(options){return null==options&&(options={}),$(this).snUsersTriggers("signinFormSubmit")},afterSignin:function(res){return null==res&&(res={}),res.signin&&null!=res.signin.login&&null!=res.signin.hash?window.user={login:res.signin.login,hash:res.signin.hash}:void 0},exit:function(){return null!=window.user?window.user={}:void 0}},$.fn.snUsers=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):$this.init.apply(this,arguments)}}),$(function(){var $this;return $this={signin:function(callback){return $.ajax({url:"index.php",type:"GET",data:{action:"signin",login:$("#signin-login").val(),password:$("#signin-password").val()},dataType:"json",success:function(s){return null!=s&&null!=callback?callback(s):void 0},error:function(XMLHttpRequest,textStatus,error){return"undefined"!=typeof console&&null!==console?console.log(XMLHttpRequest,textStatus,error):void 0}})}},$.fn.snUsersAjax=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):void 0}}),$(function(){var $this;return $this={signinFormSubmit:function(options){var _this;return null==options&&(options={}),_this=this,$("#signin-form").on("submit",function(e){return e.preventDefault(),$(".signin-alert").hide(),$(_this).snUsersAjax("signin",function(res){return null!=res.signin?($(_this).snUsers("afterSignin",res),res.signin?($("#signin-form").hide(),$(".signin-exit-link").parent("li").show(),$(".signin-enter-link").parent("li").hide(),$(".signin-alert-success").show()):($(".signin-alert-error").show(),$("#signin-password").val(""))):void 0})}),$(".signin-enter-link").on("click",function(e){return e.preventDefault(),$("#signin-login").val(""),$("#signin-password").val(""),$(".signin-alert").hide()}),$(".signin-exit-link").on("click",function(e){return e.preventDefault(),$(".signin-exit-link").parent("li").hide(),$(".signin-enter-link").parent("li").show(),$("#signin-form").show(),$(".signin-alert").hide(),$("#signin-password").val(""),$(_this).snUsers("exit")})}},$.fn.snUsersTriggers=function(sn){return null==sn&&(sn={}),$this[sn]?$this[sn].apply(this,Array.prototype.slice.call(arguments,1)):void 0}});